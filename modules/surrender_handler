from aiogram import types
import asyncpg
from bot_config import DB_URL

def register_surrender_handler(dp):

    async def connect_db():
        return await asyncpg.connect(DB_URL)

    @dp.message_handler(commands=["surrender"])
    async def surrender(message: types.Message):
        user = message.from_user
        user_id = user.id

        conn = await connect_db()
        await conn.execute(
            """
            UPDATE users 
            SET xp = 0, surrendered = TRUE 
            WHERE user_id = $1
            """,
            user_id
        )
        await conn.close()

        await message.reply(
            f"â˜ ï¸ {user.full_name}, Kamu telah menyerah dari gym virtual...\n"
            f"Semua EXP telah di-reset. Kamu akan diabaikan oleh sistem XP untuk saat ini.\n\n"
            f"Kalau someday kamu mau comeback dan latihan lagi, tinggal bilang ğŸ’ª"
        )
